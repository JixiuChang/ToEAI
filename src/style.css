/* ============================================================================
   Global design tokens (calm purple theme)
   ========================================================================= */
:root{
  /* Palette */
  --bg: #0b0e13;              /* page background */
  --panel: #111623;           /* surfaces (topbar, sidebar, cards) */
  --panel-2: #151c2c;         /* deeper surface */
  --border: rgba(255,255,255,.08);
  --text: #eaeaf2;
  --muted: #a7afbf;

  /* Accent (soothing purple) */
  --brand: #B19CFF;           /* primary accent */
  --brand-2: #9F87FF;         /* hover/darker */
  --brand-fade: rgba(177,156,255,.14);

  /* Chat bubbles */
  --bubble-user: rgba(177,156,255,.22);
  --bubble-ai: #131a28;

  /* Sidebar sizing */
  --sidebar-w: 280px;
  --sidebar-w-collapsed: 72px;

  /* Shadows */
  --shadow-1: 0 6px 20px rgba(0,0,0,.35);
  --shadow-2: 0 12px 40px rgba(0,0,0,.50);

  /* Max content width for chat/composer */
  --content-w: 820px;
}

/* ============================================================================
   Resets / base
   ========================================================================= */
*{ box-sizing:border-box }
html, body, #app{ height:100% }
html, body{ margin:0; background:var(--bg); color:var(--text); }
body{
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
  -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
}

/* Prevent the PAGE from scrolling; only messages scroll */
html, body{ overflow: hidden; }

/* Links */
a{ color: var(--brand); text-decoration: none }
a:hover{ text-decoration: underline }

/* Utility */
.muted{ color: var(--muted) }
.hidden{ display:none }

/* ============================================================================
   App shell (Sidebar | Main)
   ========================================================================= */
.app-shell{
  height: 100vh;
  display: grid;
  grid-template-columns: var(--sidebar-w) 1fr;
  overflow: hidden;  /* critical: avoid page scroll */
}
.app-shell.collapsed{ grid-template-columns: var(--sidebar-w-collapsed) 1fr; }

.main{
  min-width: 0;
  height: 100vh;
  display: flex;
  flex-direction: column; /* topbar + messages + composer */
}

/* ============================================================================
   Topbar
   ========================================================================= */
.topbar{
  height:56px;
  display:flex; align-items:center; justify-content:space-between;
  padding:0 12px;
  border-bottom:1px solid var(--border);
  background: var(--panel);
}

/* ============================================================================
   Buttons / Inputs
   ========================================================================= */
.btn{
  background: var(--panel-2); color: var(--text);
  border:1px solid var(--border);
  border-radius:10px; padding:8px 12px; cursor:pointer;
}
.btn:hover{ background:#1a2235 }

.btn-primary{
  background: var(--brand); color:#0b0e13;
  border:none; border-radius:10px; padding:10px 14px; cursor:pointer;
  box-shadow: var(--shadow-1);
}
.btn-primary:hover{ background: var(--brand-2); color:#fff }

.icon-btn{
  display:flex; align-items:center; justify-content:center;
  width:34px; height:34px; border-radius:8px; cursor:pointer;
  border:1px solid var(--border); background:var(--panel-2); color:var(--text);
}
.icon-btn:hover{ background:#1a2235 }

.input, .textarea{
  background:#0f1522; color:var(--text);
  border:1px solid var(--border);
  border-radius:12px; padding:10px 12px; outline:none;
}
.input:focus, .textarea:focus{ border-color:#2b3a52 }

/* ============================================================================
   Sidebar (ChatGPT-like)
   ========================================================================= */
.sidebar{
  position: relative;
  background: var(--panel);
  border-right:1px solid var(--border);
  height:100vh;
  padding:10px;
  overflow: hidden; /* internal list scrolls */
}

/* Header row */
.sidebar .head{
  display:flex; align-items:center; justify-content:space-between;
  padding: 6px 2px 8px;
}
.sidebar .logo-row{ display:flex; align-items:center; gap:8px }
.sidebar .logo-dot{ width:8px; height:8px; border-radius:999px; background: var(--brand) }
.sidebar strong{ font-weight: 600 }

/* New chat button (full width) */
.sidebar .new-chat{
  display:flex; align-items:center; justify-content:center;
  width:100%; gap:8px;
  background: var(--panel-2);
  border:1px solid var(--border);
  color: var(--text);
  border-radius:10px;
  padding:10px 12px;
  cursor:pointer;
}
.sidebar .new-chat:hover{ background:#1a2235; border-color:#2a3550 }

/* Conversation list — compact like ChatGPT */
.sidebar .list{
  margin-top:10px;
  display:grid; gap:6px;
  height: calc(100% - 62px); /* header + new chat height */
  overflow:auto; padding-right:4px;
}
.sidebar .item{
  display:flex; align-items:center; gap:10px;
  min-height:40px;
  padding:8px 10px;
  background: transparent;
  border:1px solid transparent;
  border-radius:8px;
  cursor:pointer;
}
.sidebar .item:hover{
  background: var(--panel-2);
  border-color: var(--border);
}
.sidebar .item.active{
  background: var(--panel-2);
  border-color: var(--brand);
  box-shadow: 0 0 0 1px var(--brand) inset;
}
.sidebar .file-ico{ flex: 0 0 16px; opacity:.85 }
.sidebar .title{
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}

/* Mobile drawer */
.overlay{ position:fixed; inset:0; background:rgba(0,0,0,.45); z-index:59 }
@media (max-width: 960px){
  .app-shell{ grid-template-columns: 1fr } /* sidebar overlays */
  .sidebar{
    position: fixed; inset:0 auto 0 0; z-index:60; width:min(82vw,320px);
    transform: translateX(-100%); transition: transform .2s ease;
  }
  .sidebar.open{ transform: translateX(0) }
}

/* ============================================================================
   Chat area
   ========================================================================= */
.chat-head{
  height:56px;
  display:flex; align-items:center; gap:12px;
  padding:0 16px;
  background: var(--panel);
  border-bottom:1px solid var(--border);
}
.messages{
  flex: 1;                 /* fills the vertical space */
  overflow: auto;          /* ONLY messages scroll */
  padding: 16px 0;
  display: grid;
  gap: 12px;
  align-content: start;
}
.msg-wrap{ display:grid; gap:12px; padding: 0 16px }

/* Bubbles */
.bubble{
  max-width:min(var(--content-w), 92%);
  padding:12px 14px; border-radius:14px;
  border:1px solid var(--border);
  white-space: pre-wrap; word-break: break-word;
}
.bubble.user{ background: var(--bubble-user); color:#fff; justify-self: end }
.bubble.assistant{ background: var(--bubble-ai); color: var(--text); justify-self: start }

/* ============================================================================
   Composer — pinned like ChatGPT
   ========================================================================= */
.composer{
  position: sticky;
  bottom: 0;
  z-index: 5;
  border-top:1px solid var(--border);
  background: linear-gradient(0deg, rgba(11,14,19,1) 40%, rgba(11,14,19,.6) 100%);
  padding: 14px 16px calc(18px + env(safe-area-inset-bottom)); /* iOS safe area */
}
.composer-inner{
  max-width: var(--content-w);
  margin: 0 auto;
  width: 100%;
}
.composer-box{
  background: var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:8px;
  display:flex; align-items:flex-end; gap:8px;
  box-shadow: var(--shadow-1);
}
.textarea{
  flex:1;
  background: transparent;
  border: none;
  resize: none;
  max-height: 40dvh; /* prevents runaway on mobile */
}

/* Attachments chips line */
.attach-chips{
  display:flex; gap:6px; flex-wrap:wrap; margin: 8px 2px 0;
}
.chip{
  background: var(--panel-2); border:1px solid var(--border);
  border-radius: 999px; padding: 6px 8px; font-size:12px;
  display:flex; align-items:center; gap:6px;
}
.chip .x{ background: transparent; border:none; color: var(--muted); cursor:pointer }
.chip .x:hover{ color:#fff }

.hint-row{
  margin-top: 8px; color: var(--muted); font-size: 12px; text-align: center;
}

/* Quick prompt chips (music-focused) */
.quick-row{
  max-width: var(--content-w);
  margin: 6px auto 6px;
  display:flex; gap:8px; flex-wrap:wrap;
  padding: 0 2px;
}
.quick{
  background: var(--brand-fade);
  color: var(--text);
  border:1px solid var(--border);
  cursor:pointer;
  border-radius: 999px;
  padding: 6px 10px;
  font-size: 12px;
}
.quick:hover{ background: rgba(177,156,255,.20) }

/* ============================================================================
   Responsiveness (desktop & mobile)
   ========================================================================= */
/* Large screens (1440p/2K) just get breathing room automatically via max-widths.
   You can tweak --content-w above if you want wider. */

/* Smaller screens */
@media (max-width: 900px){
  :root{ --content-w: 680px; }
}
@media (max-width: 600px){
  :root{ --content-w: 92vw; }
  .composer{ padding: 10px 10px calc(14px + env(safe-area-inset-bottom)); }
  .composer-box{ border-radius: 14px; }
  .msg-wrap{ padding: 0 10px }
}
